!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.markerjs={})}(this,function(t){"use strict";var e=function(){function t(){}return Object.defineProperty(t,"isLicensed",{get:function(){return!!t.key},enumerable:!0,configurable:!0}),t}(),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function n(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function o(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var i,n,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s}var s=function(){function t(){}return t.createRect=function(e,r,i){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.setAttribute("width",e.toString()),n.setAttribute("height",r.toString()),i&&t.setAttributes(n,i),n},t.createLine=function(e,r,i,n,o){var s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",e.toString()),s.setAttribute("y1",r.toString()),s.setAttribute("x2",i.toString()),s.setAttribute("y2",n.toString()),o&&t.setAttributes(s,o),s},t.createPolygon=function(e,r){var i=document.createElementNS("http://www.w3.org/2000/svg","polygon");return i.setAttribute("points",e),r&&t.setAttributes(i,r),i},t.createCircle=function(e,r){var i=document.createElementNS("http://www.w3.org/2000/svg","circle");return i.setAttribute("cx",(e/2).toString()),i.setAttribute("cy",(e/2).toString()),i.setAttribute("r",e.toString()),r&&t.setAttributes(i,r),i},t.createGroup=function(e){var r=document.createElementNS("http://www.w3.org/2000/svg","g");return e&&t.setAttributes(r,e),r},t.setAttributes=function(t,e){var r,i;try{for(var s=n(e),a=s.next();!a.done;a=s.next()){var l=o(a.value,2),c=l[0],u=l[1];t.setAttribute(c,u)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.createTransform=function(){return document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGTransform()},t.createDefs=function(){return document.createElementNS("http://www.w3.org/2000/svg","defs")},t.createMarker=function(e,r,i,n,o,s,a){var l=document.createElementNS("http://www.w3.org/2000/svg","marker");return t.setAttributes(l,[["id",e],["orient",r],["markerWidth",i.toString()],["markerHeight",n.toString()],["refX",o.toString()],["refY",s.toString()]]),l.appendChild(a),l},t.createText=function(e){var r=document.createElementNS("http://www.w3.org/2000/svg","text");return r.setAttribute("x","0"),r.setAttribute("y","0"),e&&t.setAttributes(r,e),r},t.createTSpan=function(e,r){var i=document.createElementNS("http://www.w3.org/2000/svg","tspan");return i.textContent=e,r&&t.setAttributes(i,r),i},t}(),a=function(){function t(){}return t.prototype.rasterize=function(t,e,r){var i=document.createElement("canvas");i.width=e.width.baseVal.value,i.height=e.height.baseVal.value;var n=e.outerHTML,o=i.getContext("2d");o.drawImage(t,0,0,i.width,i.height);var s=window.URL,a=new Image(i.width,i.height);a.setAttribute("crossOrigin","anonymous");var l=new Blob([n],{type:"image/svg+xml"}),c=s.createObjectURL(l);a.onload=function(){o.drawImage(a,0,0),s.revokeObjectURL(c),r(i.toDataURL("image/png"))},a.src=c},t}(),l=function(){return function(t,e){var r=this;this.getElement=function(){var t=document.createElement("div");return"separator"!==r.toolbarItem.name?(t.className="markerjs-toolbar-button",r.clickHandler&&t.addEventListener("click",function(t){r.clickHandler&&r.clickHandler(t,r.toolbarItem)}),r.toolbarItem.icon?(t.title=r.toolbarItem.tooltipText,t.innerHTML=r.toolbarItem.icon):t.innerText=r.toolbarItem.tooltipText):t.className="markerjs-toolbar-separator",t},this.toolbarItem=t,this.clickHandler=e}}(),c=function(){return function(t,e){var r=this;this.getUI=function(){var t,e;r.toolbarUI=document.createElement("div"),r.toolbarUI.className="markerjs-toolbar";try{for(var i=n(r.toolbarItems),o=i.next();!o.done;o=i.next()){var s=o.value,a=new l(s,r.clickHandler);r.toolbarUI.appendChild(a.getElement())}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return r.toolbarUI},this.toolbarItems=t,this.clickHandler=e}}(),u=function(){function t(){var t=this;this.defs=[],this.width=200,this.height=50,this.isActive=!0,this.isResizing=!1,this.previousMouseX=0,this.previousMouseY=0,this.isDragging=!1,this.manipulate=function(e){var r=t.visual.getScreenCTM().a,i=(e.screenX-t.previousMouseX)/r,n=(e.screenY-t.previousMouseY)/r;t.isDragging&&t.move(i,n),t.isResizing&&t.resize(i,n),t.previousMouseX=e.screenX,t.previousMouseY=e.screenY},this.addToVisual=function(e){t.visual.appendChild(e)},this.addToRenderVisual=function(e){t.renderVisual.appendChild(e)},this.mouseDown=function(e){e.stopPropagation(),t.select(),t.isDragging=!0,t.previousMouseX=e.screenX,t.previousMouseY=e.screenY},this.mouseUp=function(e){e.stopPropagation(),t.endManipulation()},this.mouseMove=function(e){e.stopPropagation(),t.manipulate(e)},this.move=function(e,r){var i=t.visual.transform.baseVal.getItem(0);i.setMatrix(i.matrix.translate(e,r)),t.visual.transform.baseVal.replaceItem(i,0)}}return t.prototype.endManipulation=function(){this.isDragging=!1,this.isResizing=!1},t.prototype.select=function(){this.isActive=!0,this.onSelected&&this.onSelected(this)},t.prototype.deselect=function(){this.isActive=!1,this.endManipulation()},t.prototype.setup=function(){this.visual=s.createGroup(),this.visual.transform.baseVal.appendItem(s.createTransform()),this.visual.addEventListener("mousedown",this.mouseDown),this.visual.addEventListener("mouseup",this.mouseUp),this.visual.addEventListener("mousemove",this.mouseMove),this.visual.addEventListener("touchstart",this.onTouch,{passive:!1}),this.visual.addEventListener("touchend",this.onTouch,{passive:!1}),this.visual.addEventListener("touchmove",this.onTouch,{passive:!1}),this.renderVisual=s.createGroup([["class","render-visual"]]),this.visual.appendChild(this.renderVisual)},t.prototype.resize=function(t,e){},t.prototype.onTouch=function(t){t.preventDefault();var e=document.createEvent("MouseEvents"),r=t.changedTouches[0],i=null;switch(t.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup"}e.initMouseEvent(i,!0,!0,window,0,r.screenX,r.screenY,r.clientX,r.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),t.target.dispatchEvent(e)},t.createMarker=function(){var e=new t;return e.setup(),e},t}(),h=function(){return function(){this.GRIP_SIZE=10,this.visual=s.createCircle(this.GRIP_SIZE,[["class","markerjs-control-grip"]])}}(),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MIN_LENGTH=20,e.x1=0,e.y1=0,e.x2=e.width,e.y2=0,e.getLineLength=function(t,e,r,i){var n=Math.abs(t-r),o=Math.abs(e-i);return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},e.addControlBox=function(){e.controlBox=s.createGroup([["class","markerjs-line-control-box"]]),e.addToVisual(e.controlBox),e.addControlGrips()},e.adjustControlBox=function(){e.positionGrips()},e.addControlGrips=function(){e.controlGrip1=e.createGrip(),e.controlGrip2=e.createGrip(),e.positionGrips()},e.createGrip=function(){var t=new h;return t.visual.transform.baseVal.appendItem(s.createTransform()),e.controlBox.appendChild(t.visual),t.visual.addEventListener("mousedown",e.gripMouseDown),t.visual.addEventListener("mousemove",e.gripMouseMove),t.visual.addEventListener("mouseup",e.gripMouseUp),t.visual.addEventListener("touchstart",e.onTouch,{passive:!1}),t.visual.addEventListener("touchend",e.onTouch,{passive:!1}),t.visual.addEventListener("touchmove",e.onTouch,{passive:!1}),t},e.positionGrips=function(){var t=e.controlGrip1.GRIP_SIZE,r=e.x1-t/2,i=e.y1-t/2,n=e.x2-t/2,o=e.y2-t/2;e.positionGrip(e.controlGrip1.visual,r,i),e.positionGrip(e.controlGrip2.visual,n,o)},e.positionGrip=function(t,e,r){var i=t.transform.baseVal.getItem(0);i.setTranslate(e,r),t.transform.baseVal.replaceItem(i,0)},e.gripMouseDown=function(t){e.isResizing=!0,e.activeGrip=t.target===e.controlGrip1.visual?e.controlGrip1:e.controlGrip2,e.previousMouseX=t.screenX,e.previousMouseY=t.screenY,t.stopPropagation()},e.gripMouseUp=function(t){e.isResizing=!1,e.activeGrip=null,t.stopPropagation()},e.gripMouseMove=function(t){e.isResizing&&e.resize(t.movementX,t.movementY)},e}return i(e,t),e.prototype.endManipulation=function(){t.prototype.endManipulation.call(this),this.isResizing=!1,this.activeGrip=null},e.prototype.select=function(){t.prototype.select.call(this),this.controlBox.style.display=""},e.prototype.deselect=function(){t.prototype.deselect.call(this),this.controlBox.style.display="none"},e.prototype.setup=function(){t.prototype.setup.call(this),this.markerBgLine=s.createLine(0,0,this.x2,0,[["stroke","transparent"],["stroke-width","30"]]),this.addToRenderVisual(this.markerBgLine),this.markerLine=s.createLine(0,0,this.x2,0),this.addToRenderVisual(this.markerLine),this.addControlBox()},e.prototype.resize=function(t,e){this.activeGrip&&(this.activeGrip===this.controlGrip1&&this.getLineLength(this.x1+t,this.y1+1,this.x2,this.y2)>=this.MIN_LENGTH?(this.x1+=t,this.y1+=e,this.markerBgLine.setAttribute("x1",this.x1.toString()),this.markerBgLine.setAttribute("y1",this.y1.toString()),this.markerLine.setAttribute("x1",this.x1.toString()),this.markerLine.setAttribute("y1",this.y1.toString())):this.activeGrip===this.controlGrip2&&this.getLineLength(this.x1,this.y1,this.x2+t,this.y2+e)>=this.MIN_LENGTH&&(this.x2+=t,this.y2+=e,this.markerBgLine.setAttribute("x2",this.x2.toString()),this.markerBgLine.setAttribute("y2",this.y2.toString()),this.markerLine.setAttribute("x2",this.x2.toString()),this.markerLine.setAttribute("y2",this.y2.toString()))),this.adjustControlBox()},e.createMarker=function(){var t=new e;return t.setup(),t},e}(u),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ARROW_SIZE=6,e}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),s.setAttributes(this.visual,[["class","arrow-marker"]]);var e=s.createPolygon("0,0 "+this.ARROW_SIZE+","+this.ARROW_SIZE/2+" 0,"+this.ARROW_SIZE,[["class","arrow-marker-tip"]]);this.defs.push(s.createMarker("arrow-marker-head","auto",this.ARROW_SIZE,this.ARROW_SIZE,this.ARROW_SIZE-1,this.ARROW_SIZE/2,e)),this.markerLine.setAttribute("marker-end","url(#arrow-marker-head")},e.createMarker=function(){var t=new e;return t.setup(),t},e}(p),m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z"/></svg>',g=function(){return function(){this.name="arrow-marker",this.tooltipText="Arrow",this.icon=m,this.markerType=d}}(),v=function(){return function(){var t=this;this.findGripByVisual=function(e){switch(e){case t.topLeft.visual:return t.topLeft;case t.topCenter.visual:return t.topCenter;case t.topRight.visual:return t.topRight;case t.centerLeft.visual:return t.centerLeft;case t.centerRight.visual:return t.centerRight;case t.bottomLeft.visual:return t.bottomLeft;case t.bottomCenter.visual:return t.bottomCenter;case t.bottomRight.visual:return t.bottomRight}}}}(),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MIN_SIZE=5,e.CB_DISTANCE=10,e.addControlBox=function(){e.controlBox=s.createGroup([["class","markerjs-rect-control-box"]]);var t=s.createTransform();t.setTranslate(-e.CB_DISTANCE/2,-e.CB_DISTANCE/2),e.controlBox.transform.baseVal.appendItem(t),e.addToVisual(e.controlBox),e.controlRect=s.createRect(e.width+e.CB_DISTANCE,e.height+e.CB_DISTANCE,[["class","markerjs-rect-control-rect"]]),e.controlBox.appendChild(e.controlRect),e.controlGrips=new v,e.addControlGrips()},e.adjustControlBox=function(){e.controlRect.setAttribute("width",(e.width+e.CB_DISTANCE).toString()),e.controlRect.setAttribute("height",(e.height+e.CB_DISTANCE).toString()),e.positionGrips()},e.addControlGrips=function(){e.controlGrips.topLeft=e.createGrip(),e.controlGrips.topCenter=e.createGrip(),e.controlGrips.topRight=e.createGrip(),e.controlGrips.centerLeft=e.createGrip(),e.controlGrips.centerRight=e.createGrip(),e.controlGrips.bottomLeft=e.createGrip(),e.controlGrips.bottomCenter=e.createGrip(),e.controlGrips.bottomRight=e.createGrip(),e.positionGrips()},e.createGrip=function(){var t=new h;return t.visual.transform.baseVal.appendItem(s.createTransform()),e.controlBox.appendChild(t.visual),t.visual.addEventListener("mousedown",e.gripMouseDown),t.visual.addEventListener("mousemove",e.gripMouseMove),t.visual.addEventListener("mouseup",e.gripMouseUp),t.visual.addEventListener("touchstart",e.onTouch,{passive:!1}),t.visual.addEventListener("touchend",e.onTouch,{passive:!1}),t.visual.addEventListener("touchmove",e.onTouch,{passive:!1}),t},e.positionGrips=function(){var t=e.controlGrips.topLeft.GRIP_SIZE,r=-t/2,i=r,n=(e.width+e.CB_DISTANCE)/2-t/2,o=(e.height+e.CB_DISTANCE)/2-t/2,s=e.height+e.CB_DISTANCE-t/2,a=e.width+e.CB_DISTANCE-t/2;e.positionGrip(e.controlGrips.topLeft.visual,r,i),e.positionGrip(e.controlGrips.topCenter.visual,n,i),e.positionGrip(e.controlGrips.topRight.visual,a,i),e.positionGrip(e.controlGrips.centerLeft.visual,r,o),e.positionGrip(e.controlGrips.centerRight.visual,a,o),e.positionGrip(e.controlGrips.bottomLeft.visual,r,s),e.positionGrip(e.controlGrips.bottomCenter.visual,n,s),e.positionGrip(e.controlGrips.bottomRight.visual,a,s)},e.positionGrip=function(t,e,r){var i=t.transform.baseVal.getItem(0);i.setTranslate(e,r),t.transform.baseVal.replaceItem(i,0)},e.gripMouseDown=function(t){e.isResizing=!0,e.activeGrip=e.controlGrips.findGripByVisual(t.target),e.previousMouseX=t.screenX,e.previousMouseY=t.screenY,t.stopPropagation()},e.gripMouseUp=function(t){e.isResizing=!1,e.activeGrip=null,t.stopPropagation()},e.gripMouseMove=function(t){e.isResizing&&e.manipulate(t)},e}return i(e,t),e.prototype.endManipulation=function(){t.prototype.endManipulation.call(this),this.isResizing=!1,this.activeGrip=null},e.prototype.select=function(){t.prototype.select.call(this),this.controlBox.style.display=""},e.prototype.deselect=function(){t.prototype.deselect.call(this),this.controlBox.style.display="none"},e.prototype.setup=function(){t.prototype.setup.call(this),this.addControlBox()},e.prototype.resize=function(t,e){var r=0,i=0;switch(this.activeGrip){case this.controlGrips.topLeft:this.width-=t,this.height-=e,r+=t,i+=e;break;case this.controlGrips.bottomLeft:this.width-=t,this.height+=e,r+=t;break;case this.controlGrips.topRight:this.width+=t,this.height-=e,i+=e;break;case this.controlGrips.bottomRight:this.width+=t,this.height+=e;break;case this.controlGrips.centerLeft:this.width-=t,r+=t;break;case this.controlGrips.centerRight:this.width+=t;break;case this.controlGrips.topCenter:this.height-=e,i+=e;break;case this.controlGrips.bottomCenter:this.height+=e}if(this.width<this.MIN_SIZE){var n=this.MIN_SIZE-this.width;this.width=this.MIN_SIZE,0!==r&&(r-=n)}if(this.height<this.MIN_SIZE){n=this.MIN_SIZE-this.height;this.height=this.MIN_SIZE,0!==i&&(i-=n)}if(0!==r||0!==i){var o=this.visual.transform.baseVal.getItem(0);o.setMatrix(o.matrix.translate(r,i)),this.visual.transform.baseVal.replaceItem(o,0)}this.adjustControlBox()},e.prototype.onTouch=function(e){t.prototype.onTouch.call(this,e)},e.createMarker=function(){var t=new e;return t.setup(),t},e}(u),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),this.markerRect=s.createRect(this.width,this.height),this.addToRenderVisual(this.markerRect)},e.prototype.resize=function(e,r){t.prototype.resize.call(this,e,r),this.markerRect.setAttribute("width",this.width.toString()),this.markerRect.setAttribute("height",this.height.toString())},e.createMarker=function(){var t=new e;return t.setup(),t},e}(f),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),s.setAttributes(this.visual,[["class","cover-marker"]])},e.createMarker=function(){var t=new e;return t.setup(),t},e}(w),x='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"/></svg>',b=function(){return function(){this.name="cover-marker",this.tooltipText="Cover",this.icon=x,this.markerType=k}}(),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),s.setAttributes(this.visual,[["class","highlight-marker"]])},e.createMarker=function(){var t=new e;return t.setup(),t},e}(w),I='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 544 512"><path d="M0 479.98L99.92 512l35.45-35.45-67.04-67.04L0 479.98zm124.61-240.01a36.592 36.592 0 0 0-10.79 38.1l13.05 42.83-50.93 50.94 96.23 96.23 50.86-50.86 42.74 13.08c13.73 4.2 28.65-.01 38.15-10.78l35.55-41.64-173.34-173.34-41.52 35.44zm403.31-160.7l-63.2-63.2c-20.49-20.49-53.38-21.52-75.12-2.35L190.55 183.68l169.77 169.78L530.27 154.4c19.18-21.74 18.15-54.63-2.35-75.13z"/></svg>',M=function(){return function(){this.name="cover-marker",this.tooltipText="Cover",this.icon=I,this.markerType=y}}(),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),s.setAttributes(this.visual,[["class","line-marker"]])},e.createMarker=function(){var t=new e;return t.setup(),t},e}(p),T='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M594.53 508.63L6.18 53.9c-6.97-5.42-8.23-15.47-2.81-22.45L23.01 6.18C28.43-.8 38.49-2.06 45.47 3.37L633.82 458.1c6.97 5.42 8.23 15.47 2.81 22.45l-19.64 25.27c-5.42 6.98-15.48 8.23-22.46 2.81z"/></svg>',C=function(){return function(){this.name="line-marker",this.tooltipText="Line",this.icon=T,this.markerType=E}}(),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),s.setAttributes(this.visual,[["class","rect-marker"]])},e.createMarker=function(){var t=new e;return t.setup(),t},e}(w),G='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V86c0-3.3 2.7-6 6-6h340c3.3 0 6 2.7 6 6v340c0 3.3-2.7 6-6 6z"/></svg>',S=function(){return function(){this.name="rect-marker",this.tooltipText="Rectangle",this.icon=G,this.markerType=L}}(),A='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg>',R='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>',B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MIN_SIZE=50,e.DEFAULT_TEXT="Double-click to edit text",e.text=e.DEFAULT_TEXT,e.inDoubleTap=!1,e.renderText=function(){for(var t,r;e.textElement.lastChild;)e.textElement.removeChild(e.textElement.lastChild);var i=e.text.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);try{for(var o=n(i),a=o.next();!a.done;a=o.next()){var l=a.value;""===l.trim()&&(l=" "),e.textElement.appendChild(s.createTSpan(l,[["x","0"],["dy","1.2em"]]))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}setTimeout(e.sizeText,10)},e.sizeText=function(){var t=e.textElement.getBBox(),r=0,i=0,n=1;if(t.width>0&&t.height>0){var o=1*e.width/t.width,s=1*e.height/t.height;n=Math.min(o,s),r=(e.width-t.width*n)/2,i=(e.height-t.height*n)/2}e.textElement.transform.baseVal.getItem(0).setTranslate(r,i),e.textElement.transform.baseVal.getItem(1).setScale(n,n)},e.onDblClick=function(t){e.showEditor()},e.onTap=function(t){e.inDoubleTap?(e.inDoubleTap=!1,e.showEditor()):(e.inDoubleTap=!0,setTimeout(function(){e.inDoubleTap=!1},300))},e.showEditor=function(){e.editor=document.createElement("div"),e.editor.className="markerjs-text-editor",e.editorTextArea=document.createElement("textarea"),e.text!==e.DEFAULT_TEXT&&(e.editorTextArea.value=e.text),e.editorTextArea.addEventListener("keydown",e.onEditorKeyDown),e.editor.appendChild(e.editorTextArea),document.body.appendChild(e.editor);var t=document.createElement("div");t.className="markerjs-text-editor-button-bar",e.editor.appendChild(t);var r=document.createElement("div");r.className="markerjs-text-editor-button",r.innerHTML=A,r.addEventListener("click",e.onEditorOkClick),t.appendChild(r);var i=document.createElement("div");i.className="markerjs-text-editor-button",i.innerHTML=R,i.addEventListener("click",e.closeEditor),t.appendChild(i)},e.onEditorOkClick=function(t){e.editorTextArea.value.trim()?e.text=e.editorTextArea.value:e.text=e.DEFAULT_TEXT,e.renderText(),e.closeEditor()},e.closeEditor=function(){document.body.removeChild(e.editor)},e.onEditorKeyDown=function(t){"Enter"===t.key&&t.ctrlKey&&(t.preventDefault(),e.onEditorOkClick(null))},e}return i(e,t),e.prototype.setup=function(){t.prototype.setup.call(this),this.textElement=s.createText(),this.addToRenderVisual(this.textElement),s.setAttributes(this.visual,[["class","text-marker"]]),this.textElement.transform.baseVal.appendItem(s.createTransform()),this.textElement.transform.baseVal.appendItem(s.createTransform()),this.renderText(),this.visual.addEventListener("dblclick",this.onDblClick),this.visual.addEventListener("touchstart",this.onTap)},e.prototype.resize=function(e,r){t.prototype.resize.call(this,e,r),this.sizeText()},e.createMarker=function(){var t=new e;return t.setup(),t},e}(f),j='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M152 416h-24.013l26.586-80.782H292.8L319.386 416H296c-8.837 0-16 7.163-16 16v32c0 8.837 7.163 16 16 16h136c8.837 0 16-7.163 16-16v-32c0-8.837-7.163-16-16-16h-26.739L275.495 42.746A16 16 0 0 0 260.382 32h-72.766a16 16 0 0 0-15.113 10.746L42.739 416H16c-8.837 0-16 7.163-16 16v32c0 8.837 7.163 16 16 16h136c8.837 0 16-7.163 16-16v-32c0-8.837-7.163-16-16-16zm64.353-271.778c4.348-15.216 6.61-28.156 7.586-34.644.839 6.521 2.939 19.476 7.727 34.706l41.335 124.006h-98.619l41.971-124.068z"/></svg>',U=function(){return function(){this.name="text-marker",this.tooltipText="Text",this.icon=j,this.markerType=B}}(),H='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg>',z='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M497.941 273.941c18.745-18.745 18.745-49.137 0-67.882l-160-160c-18.745-18.745-49.136-18.746-67.883 0l-256 256c-18.745 18.745-18.745 49.137 0 67.882l96 96A48.004 48.004 0 0 0 144 480h356c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12H355.883l142.058-142.059zm-302.627-62.627l137.373 137.373L265.373 416H150.628l-80-80 124.686-124.686z"/></svg>',_='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z"/></svg>',N='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>',D='<svg viewBox="0 0 112 96" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="#e5f20d" fill-opacity=".647" d="M0 40.386h111.96V95.62H0z"/><path d="M93.61 61.452c0 .987-.328 1.831-.987 2.53-.657.7-1.52 1.048-2.591 1.048-1.481 0-2.222-.74-2.222-2.22 0-16.617-.533-29.347-1.604-38.192-1.068-8.842-2.92-13.265-5.552-13.265-4.443 0-10.94 15.509-19.497 46.52v.124c0 .987-.328 1.831-.987 2.53-.657.7-1.52 1.048-2.592 1.048-1.48 0-2.22-.74-2.22-2.22 0-3.29.165-8.392.493-15.302.33-7.732.494-13.82.494-18.262 0-6.17-.186-10.55-.556-13.142-.37-2.591-1.172-3.887-2.406-3.887-2.796 0-6.333 5.12-10.612 15.363C38.494 34.367 34.01 46.44 29.32 60.34l-1.11 3.209a5.714 5.714 0 0 1-1.42 2.097c-.617.578-1.295.864-2.036.864-.987 0-1.644-.081-1.974-.247-.328-.162-.533-.656-.617-1.48-.41-4.03-.74-9.418-.987-16.165-.163-1.728-.329-4.566-.494-8.515-.822-13.901-1.562-23.3-2.221-28.196-.657-4.893-.987-7.628-.987-8.205 0-.657.33-1.44.987-2.345.659-.903 1.276-1.357 1.85-1.357 1.319 0 2.387.947 3.21 2.838.411.906.863 4.526 1.357 10.859.493 6.335.905 14.19 1.233 23.568l.617 18.88c4.527-13.983 9.216-26.673 14.068-38.068C45.65 6.686 50.093.988 54.123.988c2.715 0 4.566 1.974 5.553 5.923.987 3.949 1.481 9.667 1.481 17.152 0 3.949-.081 9.625-.247 17.029l-.123 5.676c3.373-11.762 6.725-21.634 10.057-29.615 3.331-7.979 6.685-11.97 10.056-11.97 8.475 0 12.71 18.757 12.71 56.269z" fill-rule="nonzero"/></svg>',V=function(){return function(t){var r=this;this.toolbars=[{icon:_,name:"pointer",tooltipText:"Pointer"},{icon:z,name:"delete",tooltipText:"Delete"},{name:"separator",tooltipText:""},new S,new b,new M,new C,new g,new U,{name:"separator",tooltipText:""},{icon:H,name:"ok",tooltipText:"OK"},{icon:N,name:"close",tooltipText:"Close"}],this.scale=1,this.show=function(t,e){r.completeCallback=t,r.cancelCallback=e,r.open(),r.showUI()},this.open=function(){r.setTargetRect(),r.initMarkerCanvas(),r.attachEvents(),r.setStyles(),e.isLicensed||r.adLogo(),window.addEventListener("resize",r.adjustUI)},this.render=function(t,e){r.completeCallback=t,r.cancelCallback=e,r.selectMarker(null),r.startRender(r.renderFinished)},this.close=function(){r.toolbarUI&&document.body.removeChild(r.toolbarUI),r.markerImage&&document.body.removeChild(r.markerImageHolder),r.logoUI&&document.body.removeChild(r.logoUI)},this.addMarker=function(t){var e,i,o=t.createMarker();if(o.onSelected=r.selectMarker,o.defs&&o.defs.length>0)try{for(var s=n(o.defs),a=s.next();!a.done;a=s.next()){var l=a.value;l.id&&!r.markerImage.getElementById(l.id)&&r.defs.appendChild(l)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}r.markers.push(o),r.selectMarker(o),r.markerImage.appendChild(o.visual);var c=o.visual.getBBox(),u=r.width/2/r.scale-c.width/2,h=r.height/2/r.scale-c.height/2,p=o.visual.transform.baseVal.getItem(0);p.setMatrix(p.matrix.translate(u,h)),o.visual.transform.baseVal.replaceItem(p,0)},this.deleteActiveMarker=function(){r.activeMarker&&r.deleteMarker(r.activeMarker)},this.setTargetRect=function(){var t=r.target.getBoundingClientRect(),e=document.body.parentElement.getBoundingClientRect();r.targetRect={left:t.left-e.left,top:t.top-e.top}},this.startRender=function(t){(new a).rasterize(r.target,r.markerImage,t)},this.attachEvents=function(){r.markerImage.addEventListener("mousedown",r.mouseDown),r.markerImage.addEventListener("mousemove",r.mouseMove),r.markerImage.addEventListener("mouseup",r.mouseUp)},this.mouseDown=function(t){r.activeMarker&&(1&t.buttons)>0&&(r.activeMarker.deselect(),r.activeMarker=null)},this.mouseMove=function(t){r.activeMarker&&(1&t.buttons)>0&&r.activeMarker.manipulate(t)},this.mouseUp=function(t){r.activeMarker&&r.activeMarker.endManipulation()},this.initMarkerCanvas=function(){r.markerImageHolder=document.createElement("div"),r.markerImageHolder.id="markerjs-canvas",r.markerImageHolder.style.setProperty("touch-action","none"),r.markerImageHolder.style.setProperty("-ms-touch-action","none"),r.markerImage=document.createElementNS("http://www.w3.org/2000/svg","svg"),r.markerImage.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.markerImage.setAttribute("width",r.width.toString()),r.markerImage.setAttribute("height",r.height.toString()),r.markerImage.setAttribute("viewBox","0 0 "+r.width.toString()+" "+r.height.toString()),r.markerImageHolder.style.position="absolute",r.markerImageHolder.style.width=r.width+"px",r.markerImageHolder.style.height=r.height+"px",r.markerImageHolder.style.transformOrigin="top left",r.positionMarkerImage(),r.defs=s.createDefs(),r.markerImage.appendChild(r.defs),r.markerImageHolder.appendChild(r.markerImage),document.body.appendChild(r.markerImageHolder)},this.adjustUI=function(t){r.adjustSize(),r.positionUI()},this.adjustSize=function(){r.width=r.target.clientWidth,r.height=r.target.clientHeight;var t=r.target.clientWidth/r.markerImageHolder.clientWidth;1!==t&&(r.scale*=t,r.markerImageHolder.style.width=r.width+"px",r.markerImageHolder.style.height=r.height+"px",r.markerImageHolder.style.transform="scale("+r.scale+")")},this.positionUI=function(){r.setTargetRect(),r.positionMarkerImage(),r.positionToolbar(),r.logoUI&&r.positionLogo()},this.positionMarkerImage=function(){r.markerImageHolder.style.top=r.targetRect.top+"px",r.markerImageHolder.style.left=r.targetRect.left+"px"},this.positionToolbar=function(){r.toolbarUI.style.left=r.targetRect.left+r.target.offsetWidth-r.toolbarUI.clientWidth+"px",r.toolbarUI.style.top=r.targetRect.top-r.toolbarUI.clientHeight+"px"},this.showUI=function(){r.toolbar=new c(r.toolbars,r.toolbarClick),r.toolbarUI=r.toolbar.getUI(),document.body.appendChild(r.toolbarUI),r.toolbarUI.style.position="absolute",r.positionToolbar()},this.setStyles=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","style");t.innerHTML='\n            .rect-marker .render-visual {\n                stroke: #ff0000;\n                stroke-width: 3;\n                fill: transparent;\n            }\n            .cover-marker .render-visual {\n                stroke-width: 0;\n                fill: #000000;\n            }\n            .highlight-marker .render-visual {\n                stroke: transparent;\n                stroke-width: 0;\n                fill: #ffff00;\n                fill-opacity: 0.4;\n            }\n            .line-marker .render-visual {\n                stroke: #ff0000;\n                stroke-width: 3;\n                fill: transparent;\n            }\n            .arrow-marker .render-visual {\n                stroke: #ff0000;\n                stroke-width: 3;\n                fill: transparent;\n            }\n            .arrow-marker-tip {\n                stroke-width: 0;\n                fill: #ff0000;\n            }\n            .text-marker text {\n                fill: #ff0000;\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",\n                    Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji",\n                    "Segoe UI Emoji", "Segoe UI Symbol";\n            }\n            .markerjs-rect-control-box .markerjs-rect-control-rect {\n                stroke: black;\n                stroke-width: 1;\n                stroke-opacity: 0.5;\n                stroke-dasharray: 3, 2;\n                fill: transparent;\n            }\n            .markerjs-control-grip {\n                fill: #cccccc;\n                stroke: #333333;\n                stroke-width: 2;\n            }\n        ',r.markerImage.appendChild(t)},this.toolbarClick=function(t,e){if(e.markerType)r.addMarker(e.markerType);else switch(e.name){case"delete":r.deleteActiveMarker();break;case"pointer":r.activeMarker&&r.selectMarker(null);break;case"close":r.cancel();break;case"ok":r.complete()}},this.selectMarker=function(t){r.activeMarker&&r.activeMarker!==t&&r.activeMarker.deselect(),r.activeMarker=t},this.deleteMarker=function(t){r.markerImage.removeChild(t.visual),r.activeMarker===t&&(r.activeMarker=null),r.markers.splice(r.markers.indexOf(t),1)},this.complete=function(){r.selectMarker(null),r.startRender(r.renderFinishedClose)},this.cancel=function(){r.close(),r.cancelCallback&&r.cancelCallback()},this.renderFinished=function(t){r.completeCallback(t)},this.renderFinishedClose=function(t){r.close(),r.completeCallback(t)},this.positionLogo=function(){r.logoUI&&(r.logoUI.style.left=r.targetRect.left+10+"px",r.logoUI.style.top=r.targetRect.top+r.target.offsetHeight-r.logoUI.clientHeight-10+"px")},this.adLogo=function(){r.logoUI=document.createElement("div"),r.logoUI.className="markerjs-logo";var t=document.createElement("a");t.href="https://markerjs.com/",t.target="_blank",t.innerHTML=D,t.title="Powered by marker.js",r.logoUI.appendChild(t),document.body.appendChild(r.logoUI),r.logoUI.style.position="absolute",r.positionLogo()},this.target=t,this.width=t.clientWidth,this.height=t.clientHeight,this.markers=[],this.activeMarker=null}}();!function(t,e){void 0===e&&(e={});var r=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===r&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(".markerjs-logo {\n    display: inline-block;\n    margin: 0px;\n    padding: 0px;\n\n    fill: #333333;\n}\n\n.markerjs-logo a {\n    display: grid;\n    align-items: center;\n    justify-items: center;\n    padding: 3px;\n    width: 20px;\n    height: 20px;\n}\n\n.markerjs-logo a:hover {\n    fill: #ff8080;\n}\n\n.markerjs-toolbar {\n    background-color: #cccccc;\n    padding: 0px 5px;\n    margin: 0px;\n    border-top-left-radius: 10px;\n    border-top-right-radius: 10px;\n\n    display: grid;\n    grid-template-columns: repeat(20, auto);\n}\n\n\n.markerjs-toolbar-button, .markerjs-toolbar-logo a {\n    display: inline-block;\n    margin: 2px;\n    padding: 3px;\n    cursor: pointer;\n    width: 20px;\n    height: 20px;\n    border-radius: 2px;\n    border-bottom: transparent solid 1px;\n    border-right: transparent solid 1px;\n\n\n    fill: #333333;\n\n    display: grid;\n    align-items: center;\n    justify-items: center;\n}\n\n.markerjs-toolbar-separator {\n    margin: 5px 5px;\n    border: 1px solid #dddddd;\n}\n\n.markerjs-toolbar-button:hover, .markerjs-toolbar-logo a:hover {\n    background-color: #eeeeee;\n    background: radial-gradient(#eeeeee, #cccccc);\n\n    fill: #ff8080;\n}\n\n.markerjs-toolbar-button svg {\n    height: 16px;\n}\n\n.markerjs-text-editor {\n    position: fixed;\n    z-index: 20000;\n    left: 0px;\n    top: 0px;\n    width: 100vw;\n    height: 100vh;\n    background-color: rgba(0,0,0,0.9);\n\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n}\n\n.markerjs-text-editor textarea {\n    width: 50%;\n    min-width: 50px;\n    max-width: 500px;\n    height: 50%;\n    min-height: 50px;\n    max-height: 500px;\n}\n\n.markerjs-text-editor .markerjs-text-editor-button-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-end;\n    width: 50%;\n    min-width: 50px;\n    max-width: 500px;\n    padding-top: 10px;\n}\n.markerjs-text-editor .markerjs-text-editor-button {\n    display: grid;\n    align-items: center;\n    padding: 0px;\n    margin-left: 15px;\n    width: 20px;\n    height: 20px;\n\n    cursor: pointer;\n\n    fill: #888888;\n}\n.markerjs-text-editor .markerjs-text-editor-button:hover {\n    fill: #ff8080;\n}"),t.Activator=e,t.MarkerArea=V,t.ArrowMarker=d,t.CoverMarker=k,t.HighlightMarker=y,t.LineMarker=E,t.RectMarker=L,t.TextMarker=B,Object.defineProperty(t,"__esModule",{value:!0})});
